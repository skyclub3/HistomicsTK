

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tissue Detection module &mdash; HistomicsTK 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cellularity Detection using thresholding" href="histomicstk.saliency.cellularity_detection_thresholding.html" />
    <link rel="prev" title="histomicstk.saliency" href="histomicstk.saliency.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> HistomicsTK
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api-docs.html">API Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="histomicstk.html">histomicstk</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="histomicstk.utils.html">utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.preprocessing.html">preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.filters.html">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.segmentation.html">segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.features.html">features</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.annotations_and_masks.html">annotations and masks</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="histomicstk.saliency.html">saliency (tissue/cellularity detection)</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Tissue detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="histomicstk.saliency.cellularity_detection_thresholding.html">Cellularity detection (using thresholding)</a></li>
<li class="toctree-l4"><a class="reference internal" href="histomicstk.saliency.cellularity_detection_superpixels.html">Cellularity detection (using superpixels)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.workflows.html">workflows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HistomicsTK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="api-docs.html">API Documentation</a> &raquo;</li>
        
          <li><a href="histomicstk.html">histomicstk</a> &raquo;</li>
        
          <li><a href="histomicstk.saliency.html">histomicstk.saliency</a> &raquo;</li>
        
      <li>Tissue Detection module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/histomicstk.saliency.tissue_detection.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="tissue-detection-module">
<h1>Tissue Detection module<a class="headerlink" href="#tissue-detection-module" title="Permalink to this headline">¶</a></h1>
<p><strong>Overview:</strong>
This includes tools to detect tissue from an item (slide) using its thumbnail. The basic functionality includes a series of gaussian smoothing and otsu thresholding steps to detect background versus foreground pixels. Optionally, an initial step is performed whereby color deconvolution is used to separate hematoxylin and eosin stains (assuming H&amp;E stained slides) to make sure only cellular areas are segmented. This proves to be useful in getting rid of sharpie markers. A size threshold is used to keep only largest contiguous tissue regions.</p>
<p>This slide used as a test example:</p>
<p><a class="reference external" href="http://candygram.neurology.emory.edu:8080/histomicstk#?image=5d817f5abd4404c6b1f744bb">TCGA-A1-A0SK-01Z-00-DX1</a></p>
<p><strong>Here’s the result:</strong></p>
<p>From left to right: Slide thumbnail, Tissue regions, Largest tissue region</p>
<a class="reference external image-reference" href="https://user-images.githubusercontent.com/22067552/65110899-f4b85e00-d9a7-11e9-8782-5a5f18992ae4.png"><img alt="image" src="https://user-images.githubusercontent.com/22067552/65110899-f4b85e00-d9a7-11e9-8782-5a5f18992ae4.png" /></a>
<p><strong>Where to look?</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="n">_</span> <span class="n">histomicstk</span><span class="o">/</span>
<span class="o">|</span>   <span class="o">|</span><span class="n">_saliency</span><span class="o">/</span>
<span class="o">|</span>      <span class="o">|</span><span class="n">_tissue_detection</span><span class="o">.</span><span class="n">py</span>
<span class="o">|</span>      <span class="o">|</span><span class="n">_tests</span><span class="o">/</span>
<span class="o">|</span>         <span class="o">|</span><span class="n">_tissue_detection_test</span><span class="o">.</span><span class="n">py</span>
<span class="o">|</span><span class="n">_</span> <span class="n">docs</span><span class="o">/</span>
    <span class="o">|</span><span class="n">_examples</span><span class="o">/</span>
       <span class="o">|</span><span class="n">_tissue_detection</span><span class="o">.</span><span class="n">ipynb</span>
</pre></div>
</div>
<span class="target" id="module-histomicstk.saliency.tissue_detection"></span><p>Created on Wed Sep 18 03:29:24 2019.</p>
<p>&#64;author: mtageld</p>
<dl class="function">
<dt id="histomicstk.saliency.tissue_detection.get_slide_thumbnail">
<code class="sig-prename descclassname">histomicstk.saliency.tissue_detection.</code><code class="sig-name descname">get_slide_thumbnail</code><span class="sig-paren">(</span><em class="sig-param">gc</em>, <em class="sig-param">slide_id</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/tissue_detection.html#get_slide_thumbnail"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.tissue_detection.get_slide_thumbnail" title="Permalink to this definition">¶</a></dt>
<dd><p>Get slide thumbnail using girder client.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.8)"><em>object</em></a>) – girder client to use</p></li>
<li><p><strong>slide_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – girder ID of slide</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>RGB slide thumbnail at lowest level</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="histomicstk.saliency.tissue_detection.get_tissue_boundary_annotation_documents">
<code class="sig-prename descclassname">histomicstk.saliency.tissue_detection.</code><code class="sig-name descname">get_tissue_boundary_annotation_documents</code><span class="sig-paren">(</span><em class="sig-param">gc</em>, <em class="sig-param">slide_id</em>, <em class="sig-param">labeled</em>, <em class="sig-param">color='rgb(0</em>, <em class="sig-param">0</em>, <em class="sig-param">0)'</em>, <em class="sig-param">group='tissue'</em>, <em class="sig-param">annprops=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/tissue_detection.html#get_tissue_boundary_annotation_documents"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.tissue_detection.get_tissue_boundary_annotation_documents" title="Permalink to this definition">¶</a></dt>
<dd><p>Get annotation documents of tissue boundaries to visualize on DSA.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.8)"><em>object</em></a>) – girder client to use</p></li>
<li><p><strong>slide_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – girder ID of slide</p></li>
<li><p><strong>labeled</strong> (<em>np array</em>) – mask of tissue regions using slide thumbnail. This could either be
a binary mask or a mask where each unique value corresponds to one
tissue region. It will be binalized anyways. This can be obtained
using get_tissue_mask().</p></li>
<li><p><strong>color</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – color to assign to boundaries. format like rgb(0,0,0)</p></li>
<li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – label for annotations</p></li>
<li><p><strong>annpops</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a>) – properties of annotation elements. Contains the following keys
F, X_OFFSET, Y_OFFSET, opacity, lineWidth. Refer to
get_single_annotation_document_from_contours() for details.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>each dict is an annotation document that you can post to DSA</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of dicts</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="histomicstk.saliency.tissue_detection.get_tissue_mask">
<code class="sig-prename descclassname">histomicstk.saliency.tissue_detection.</code><code class="sig-name descname">get_tissue_mask</code><span class="sig-paren">(</span><em class="sig-param">thumbnail_im</em>, <em class="sig-param">deconvolve_first=False</em>, <em class="sig-param">stain_unmixing_routine_kwargs={}</em>, <em class="sig-param">n_thresholding_steps=1</em>, <em class="sig-param">sigma=0.0</em>, <em class="sig-param">min_size=500</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/tissue_detection.html#get_tissue_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.tissue_detection.get_tissue_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Get binary tissue mask from slide thumbnail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>thumbnail_im</strong> (<em>np array</em>) – (m, n, 3) nd array of thumbnail RGB image
or (m, n) nd array of thumbnail grayscale image</p></li>
<li><p><strong>deconvolve_first</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – use hematoxylin channel to find cellular areas?
This will make things ever-so-slightly slower but is better in
getting rid of sharpie marker (if it’s green, for example).
Sometimes things work better without it, though.</p></li>
<li><p><strong>stain_matrix_method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – see deconv_color method in seed_utils</p></li>
<li><p><strong>n_thresholding_steps</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – number of gaussian smoothign steps</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – sigma of gaussian filter</p></li>
<li><p><strong>min_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – minimum size (in pixels) of contiguous tissue regions to keep</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>np bool array</em> – largest contiguous tissue region.</p></li>
<li><p><em>np int32 array</em> – each unique value represents a unique tissue region</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="histomicstk.saliency.tissue_detection.threshold_multichannel">
<code class="sig-prename descclassname">histomicstk.saliency.tissue_detection.</code><code class="sig-name descname">threshold_multichannel</code><span class="sig-paren">(</span><em class="sig-param">im, thresholds, channels=['hue', 'saturation', 'intensity'], just_threshold=False, get_tissue_mask_kwargs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/tissue_detection.html#threshold_multichannel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.tissue_detection.threshold_multichannel" title="Permalink to this definition">¶</a></dt>
<dd><p>Threshold a multi-channel image (eg. HSI image) to get tissue.</p>
<p>The relies on the fact that oftentimes some slide elements (eg blood
or whitespace) have a characteristic hue/saturation/intensity. This
thresholds along each HSI channel, then optionally uses the
get_tissue_mask() method (gaussian smoothing, otsu thresholding,
connected components) to get each contiguous tissue piece.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>np array</em>) – (m, n, 3) array of Hue, Saturation, Intensity (in this order)</p></li>
<li><p><strong>thresholds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a>) – Each entry is a dict containing the keys min and max</p></li>
<li><p><strong>channels</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – names of channels, in order (eg. hue, saturation, intensity)</p></li>
<li><p><strong>just_threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – if Fase, get_tissue_mask() is used to smooth result and get regions.</p></li>
<li><p><strong>get_tissue_mask_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a>) – key-value pairs of parameters to pass to get_tissue_mask()</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>np int32 array</em> – if not just_threshold, unique values represent unique tissue regions</p></li>
<li><p><em>np bool array</em> – if not just_threshold, largest contiguous tissue region.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="histomicstk.saliency.cellularity_detection_thresholding.html" class="btn btn-neutral float-right" title="Cellularity Detection using thresholding" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="histomicstk.saliency.html" class="btn btn-neutral float-left" title="histomicstk.saliency" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Kitware, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>